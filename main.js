(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e=function(){function e(t,n){var o=t.items,r=t.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=o,this._renderItem=r,this._container=document.querySelector(n)}var n,o;return n=e,o=[{key:"addItem",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this._container.prepend(t):this._container.append(t)}},{key:"renderItems",value:function(){var t=this;this._data.forEach((function(e){t._renderItem(e)}))}}],o&&t(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function t(e,n,o,r,i,a,u,c){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cardId=e._id,this._link=e.link,this._title=e.name,this._likes=e.likes,this._templateSelector=n,this._handleCardClick=o,this._handleTrashButtonClick=r,this._setLike=i,this._setDislike=a,this._isLiked=u,this._isOwned=c,this._ownerId=e.owner._id}var e,o;return e=t,(o=[{key:"_handleLikeButton",value:function(t){var e=this;this._likeButton.classList.contains("element__heart-button_active")?this._setDislike(this._cardId).then((function(t){e._likeButton.classList.remove("element__heart-button_active"),e._likesElement.textContent=t.likes.length})).catch((function(){console.log("ошибка снятия лайка")})):this._setLike(this._cardId).then((function(t){e._likeButton.classList.add("element__heart-button_active"),e._likesElement.textContent=t.likes.length})).catch((function(){console.log("ошибка установки лайка")}))}},{key:"removeCard",value:function(){this._cardElement.remove(),this._cardElement=null}},{key:"getCardId",value:function(){return this._cardId}},{key:"_setEventListeners",value:function(){var t=this;this._likeButton.addEventListener("click",(function(){t._handleLikeButton(t._likeButton)})),this._deleteButton.addEventListener("click",(function(){t._handleTrashButtonClick(t)})),this._cardImage.addEventListener("click",(function(){t._handleCardClick(t._link,t._title)}))}},{key:"generateCard",value:function(){return this._cardTemplate=document.querySelector(this._templateSelector).content,this._cardElement=this._cardTemplate.querySelector(".element").cloneNode(!0),this._cardImage=this._cardElement.querySelector(".element__image"),this._cardDescription=this._cardElement.querySelector(".element__name"),this._cardImage.src=this._link,this._cardImage.alt=this._link,this._cardDescription.textContent=this._title,this._likeButton=this._cardElement.querySelector(".element__heart-button"),this._likesElement=this._cardElement.querySelector(".element__likes-count"),this._likesElement.textContent=this._likes.length,this._deleteButton=this._cardElement.querySelector(".element__delete-button"),this._isLiked&&this._likeButton.classList.add("element__heart-button_active"),this._isOwned&&this._deleteButton.classList.add("element__delete-button_active"),this._setEventListeners(),this._cardElement}}])&&n(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=n,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}var e,n;return e=t,(n=[{key:"_setEventListeners",value:function(){var t=this;this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t._toggleButtonState(),t._buttonElement.addEventListener("focus",(function(){e.focus()}))}))}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled","")):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(t){return!t.validity.valid}))}},{key:"_checkInputValidity",value:function(t){var e=this._formElement.querySelector(".".concat(t.id,"-error"));t.validity.valid?this._hideInputError(t,e):this._showInputError(t,e,t.validationMessage)}},{key:"_showInputError",value:function(t,e,n){t.classList.add(this._inputErrorClass),e.textContent=n,e.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(t,e){t.classList.remove(this._inputErrorClass),e.classList.remove(this._errorClass),e.textContent=""}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(t){t.preventDefault()})),this._setEventListeners()}},{key:"resetValidation",value:function(){var t=this;this._inputList.forEach((function(e){var n=t._formElement.querySelector(".".concat(e.id,"-error"));t._hideInputError(e,n)})),this._toggleButtonState()}}])&&r(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),a={inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popupElement=document.querySelector(e),this._handleEscCloseBound=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"open",value:function(){document.addEventListener("keydown",this._handleEscCloseBound),this._popupElement.classList.add("popup_opened")}},{key:"close",value:function(){document.removeEventListener("keydown",this._handleEscCloseBound),this._popupElement.classList.remove("popup_opened")}},{key:"setEventListeners",value:function(){var t=this;this._popupElement.addEventListener("mousedown",(function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&t.close()}))}}])&&u(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var o=p(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},f.apply(this,arguments)}function p(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function _(t,e){if(e&&("object"===s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}var y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=d(o);if(r){var n=d(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return _(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._popupImage=e._popupElement.querySelector(".popup-gallery__image"),e._popupCaption=e._popupElement.querySelector(".popup-gallery__caption"),e}return e=a,(n=[{key:"open",value:function(t,e){this._popupImage.src=t,this._popupImage.alt=e,this._popupCaption.textContent=e,f(d(a.prototype),"open",this).call(this)}}])&&l(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(c);function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function v(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function b(){return b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var o=E(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},b.apply(this,arguments)}function E(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}function k(t,e){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},k(t,e)}function C(t,e){if(e&&("object"===m(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&k(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(o);if(r){var n=w(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return C(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._formElement=n._popupElement.querySelector(".popup__form"),n._submitButton=n._popupElement.querySelector(".popup__save-button"),n._defaultSubmitButtonCaption=n._submitButton.textContent,n._allInputs=n._formElement.querySelectorAll(".popup__input"),n._formSubmitHandle=e,n}return e=a,(n=[{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._allInputs.forEach((function(e){t._formValues[e.name]=e.value})),this._formValues}},{key:"setInputValues",value:function(t){this._allInputs.forEach((function(e){e.value=t[e.name]}))}},{key:"setSubmitCaption",value:function(t){this._submitButton.textContent=t}},{key:"setDefaultSubmitCaption",value:function(){this._submitButton.textContent=this._defaultSubmitButtonCaption}},{key:"setEventListeners",value:function(){var t=this;b(w(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(e){e.preventDefault(),t._formSubmitHandle(t._getInputValues())}))}},{key:"close",value:function(){b(w(a.prototype),"close",this).call(this),this._formElement.reset()}}])&&v(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(c);function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function O(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function j(){return j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var o=L(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},j.apply(this,arguments)}function L(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=I(t)););return t}function B(t,e){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},B(t,e)}function P(t,e){if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function I(t){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I(t)}var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=I(o);if(r){var n=I(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return P(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._confirmButton=n._popupElement.querySelector(".popup__save-button"),n._defaultConfirmButtonCaption=n._confirmButton.textContent,n._handleConfirmButton=e,n}return e=a,(n=[{key:"setCurrentCard",value:function(t){this._currentCard=t}},{key:"setConfirmButtonCaption",value:function(t){this._confirmButton.textContent=t}},{key:"setDefaultConfirmButtonCaption",value:function(){this._confirmButton.textContent=this._defaultConfirmButtonCaption}},{key:"setEventListeners",value:function(){var t=this;j(I(a.prototype),"setEventListeners",this).call(this),this._confirmButton.addEventListener("click",(function(e){t._handleConfirmButton(t._currentCard)}))}}])&&O(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(c);function R(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var q=function(){function t(e){var n=e.nameSelector,o=e.jobSelector,r=e.avatarSelector;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._nameElement=document.querySelector(n),this._jobElement=document.querySelector(o),this._avatarElement=document.querySelector(r)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return this._name=this._nameElement.textContent,this._job=this._jobElement.textContent,{name:this._name,job:this._job}}},{key:"setUserInfo",value:function(t,e,n){this._nameElement.textContent=t,this._jobElement.textContent=e,this._id=n,this._name=t,this._job=e}},{key:"setAvatar",value:function(t){this._avatarElement.src=t,this._avatarElement.alt="".concat(this._name,", ").concat(this._job)}}])&&R(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function x(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var D=function(){function t(e){var n=e.url,o=e.token;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=n,this._authToken=o,this._cards=[]}var e,n;return e=t,(n=[{key:"_checkResponse",value:function(t){return t.ok?t.json():Promise.reject("Ошибка промиса: ".concat(t.status))}},{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"/cards"),{headers:{authorization:this._authToken}}).then(this._checkResponse).catch((function(){throw new Error("карточки не найдены на сервере")}))}},{key:"addCard",value:function(t,e){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then(this._checkResponse).catch((function(){throw new Error("карточка не добавлена на сервер")}))}},{key:"deleteCard",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._authToken}}).then(this._checkResponse).catch((function(){throw new Error("карточка не удалена")}))}},{key:"getUser",value:function(){return fetch("".concat(this._url,"/users/me"),{headers:{authorization:this._authToken,"Content-Type":"application/json"}}).then(this._checkResponse).catch((function(){throw new Error("пользователь не загружен")}))}},{key:"setUser",value:function(t,e){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:e})}).then(this._checkResponse).catch((function(){throw new Error("пользователь не установлен")}))}},{key:"setAvatar",value:function(t){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(this._checkResponse).catch((function(){throw new Error("аватар не установлен")}))}},{key:"setLike",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t,"/likes"),{method:"PUT",headers:{authorization:this._authToken}}).then(this._checkResponse).catch((function(){throw new Error("лайк не установлен")}))}},{key:"removeLike",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t,"/likes"),{method:"DELETE",headers:{authorization:this._authToken}}).then(this._checkResponse).catch((function(){throw new Error("лайк не снят")}))}}])&&x(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),V=document.querySelector(".popup__form_edit"),A=document.querySelector(".popup__form_avatar"),U=document.querySelector(".popup__form_add"),z=document.querySelector(".profile__edit-button"),H=document.querySelector(".profile__avatar"),N=document.querySelector(".profile__add-button"),J=new D({url:"https://mesto.nomoreparties.co/v1/cohort-49",token:"4a3a5ed7-c33c-4007-ab2f-bb1055621552"}),M=J.getUser(),F=[J.getInitialCards(),M];Promise.all(F).then((function(t){var n=t[0],r=t[1],u=new q({nameSelector:".profile__name",jobSelector:".profile__job",avatarSelector:".profile__avatar"});u.setUserInfo(r.name,r.about,r._id),u.setAvatar(r.avatar);var c=new i(a,V);c.enableValidation();var s=new i(a,A);s.enableValidation();var l=new i(a,U);l.enableValidation();var f=new g(".popup_add",(function(t){f.setSubmitCaption("Сохранение..."),J.addCard(t.name,t.link).then((function(t){f.setSubmitCaption("Готово!"),setTimeout((function(){f.close()}),500);var e=C(t,!1,!0);m.addItem(e,!0)})).finally((function(){setTimeout((function(){f.setDefaultSubmitCaption()}),1200)}))}));f.setEventListeners();var p=new g(".popup_edit",(function(t){p.setSubmitCaption("Сохранение..."),J.setUser(t.name,t.job).then((function(){p.setSubmitCaption("Готово!"),setTimeout((function(){p.close()}),500),u.setUserInfo(t.name,t.job,r._id)})).finally((function(){setTimeout((function(){p.setDefaultSubmitCaption()}),1200)}))}));p.setEventListeners();var h=new g(".popup_avatar",(function(t){h.setSubmitCaption("Сохранение..."),J.setAvatar(t.avatar).then((function(t){h.setSubmitCaption("Готово!"),setTimeout((function(){u.setAvatar(t.avatar),h.close()}),500)})).finally((function(){setTimeout((function(){h.setDefaultSubmitCaption()}),1200)}))}));h.setEventListeners();var _=new y(".popup-gallery");_.setEventListeners();var d=new T(".popup_confirm",(function(t){d.setConfirmButtonCaption("Удаление..."),J.deleteCard(t.getCardId()).then((function(e){d.setConfirmButtonCaption("Готово!"),setTimeout((function(){t.removeCard(),d.close()}),500)})).finally((function(){setTimeout((function(){d.setDefaultConfirmButtonCaption()}),1200)}))}));d.setEventListeners();var m=new e({items:n,renderer:function(t){var e=!1;t.owner._id===r._id&&(e=!0);var n=t.likes.some((function(t){return t._id===r._id})),o=C(t,n,e);m.addItem(o,!1)}},".elements");function v(t,e){_.open(t,e)}function b(t){d.setCurrentCard(t),d.open()}function E(t){return J.setLike(t)}function k(t){return J.removeLike(t)}function C(t,e,n){return new o(t,"#card-template",v,b,E,k,e,n).generateCard()}m.renderItems(),z.addEventListener("click",(function(){p.setInputValues(u.getUserInfo()),c.resetValidation(),p.open()})),H.addEventListener("click",(function(t){s.resetValidation(),h.open()})),N.addEventListener("click",(function(){l.resetValidation(),f.open()}))})).catch((function(t){console.log("ошибка кэтч: "+t)}))})();